
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>automation.utilities.Cookie &#8212; OpenWPM  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for automation.utilities.Cookie</h1><div class="highlight"><pre>
<span></span><span class="c1">####</span>
<span class="c1"># Copyright 2000 by Timothy O&#39;Malley &lt;timo@alum.mit.edu&gt;</span>
<span class="c1">#</span>
<span class="c1">#                All Rights Reserved</span>
<span class="c1">#</span>
<span class="c1"># Permission to use, copy, modify, and distribute this software</span>
<span class="c1"># and its documentation for any purpose and without fee is hereby</span>
<span class="c1"># granted, provided that the above copyright notice appear in all</span>
<span class="c1"># copies and that both that copyright notice and this permission</span>
<span class="c1"># notice appear in supporting documentation, and that the name of</span>
<span class="c1"># Timothy O&#39;Malley  not be used in advertising or publicity</span>
<span class="c1"># pertaining to distribution of the software without specific, written</span>
<span class="c1"># prior permission.</span>
<span class="c1">#</span>
<span class="c1"># Timothy O&#39;Malley DISCLAIMS ALL WARRANTIES WITH REGARD TO THIS</span>
<span class="c1"># SOFTWARE, INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY</span>
<span class="c1"># AND FITNESS, IN NO EVENT SHALL Timothy O&#39;Malley BE LIABLE FOR</span>
<span class="c1"># ANY SPECIAL, INDIRECT OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="c1"># WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS,</span>
<span class="c1"># WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS</span>
<span class="c1"># ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR</span>
<span class="c1"># PERFORMANCE OF THIS SOFTWARE.</span>
<span class="c1">#</span>
<span class="c1">####</span>
<span class="c1">#</span>
<span class="c1"># Id: Cookie.py,v 2.29 2000/08/23 05:28:49 timo Exp</span>
<span class="c1">#   by Timothy O&#39;Malley &lt;timo@alum.mit.edu&gt;</span>
<span class="c1">#</span>
<span class="c1">#  Cookie.py is a Python module for the handling of HTTP</span>
<span class="c1">#  cookies as a Python dictionary.  See RFC 2109 for more</span>
<span class="c1">#  information on cookies.</span>
<span class="c1">#</span>
<span class="c1">#  The original idea to treat Cookies as a dictionary came from</span>
<span class="c1">#  Dave Mitchell (davem@magnet.com) in 1995, when he released the</span>
<span class="c1">#  first version of nscookie.py.</span>
<span class="c1">#</span>
<span class="c1">####</span>
<span class="c1">#</span>
<span class="c1"># This version alters the parsing rules to match those which are</span>
<span class="c1"># actually enforced in practice. These likely deviate far from the</span>
<span class="c1"># RFC specifications.</span>
<span class="c1">#</span>
<span class="c1">####</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Here&#39;s a sample session to show how to use this module.</span>
<span class="sd">At the moment, this is the only documentation.</span>

<span class="sd">The Basics</span>
<span class="sd">----------</span>

<span class="sd">Importing is easy..</span>

<span class="sd">   &gt;&gt;&gt; import Cookie</span>

<span class="sd">Most of the time you start by creating a cookie.  Cookies come in</span>
<span class="sd">three flavors, each with slightly different encoding semantics, but</span>
<span class="sd">more on that later.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SimpleCookie()</span>
<span class="sd">   &gt;&gt;&gt; C = Cookie.SerialCookie()</span>
<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>

<span class="sd">[Note: Long-time users of Cookie.py will remember using</span>
<span class="sd">Cookie.Cookie() to create a Cookie object.  Although deprecated, it</span>
<span class="sd">is still supported by the code.  See the Backward Compatibility notes</span>
<span class="sd">for more information.]</span>

<span class="sd">Once you&#39;ve created your Cookie, you can add values just as if it were</span>
<span class="sd">a dictionary.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;fig&quot;] = &quot;newton&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;sugar&quot;] = &quot;wafer&quot;</span>
<span class="sd">   &gt;&gt;&gt; C.output()</span>
<span class="sd">   &#39;Set-Cookie: fig=newton\r\nSet-Cookie: sugar=wafer&#39;</span>

<span class="sd">Notice that the printable representation of a Cookie is the</span>
<span class="sd">appropriate format for a Set-Cookie: header.  This is the</span>
<span class="sd">default behavior.  You can change the header and printed</span>
<span class="sd">attributes by using the .output() function</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;rocky&quot;] = &quot;road&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;rocky&quot;][&quot;path&quot;] = &quot;/cookie&quot;</span>
<span class="sd">   &gt;&gt;&gt; print C.output(header=&quot;Cookie:&quot;)</span>
<span class="sd">   Cookie: rocky=road; Path=/cookie</span>
<span class="sd">   &gt;&gt;&gt; print C.output(attrs=[], header=&quot;Cookie:&quot;)</span>
<span class="sd">   Cookie: rocky=road</span>

<span class="sd">The load() method of a Cookie extracts cookies from a string.  In a</span>
<span class="sd">CGI script, you would use this method to extract the cookies from the</span>
<span class="sd">HTTP_COOKIE environment variable.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C.load(&quot;chips=ahoy; vienna=finger&quot;)</span>
<span class="sd">   &gt;&gt;&gt; C.output()</span>
<span class="sd">   &#39;Set-Cookie: chips=ahoy\r\nSet-Cookie: vienna=finger&#39;</span>

<span class="sd">The load() method is darn-tootin smart about identifying cookies</span>
<span class="sd">within a string.  Escaped quotation marks, nested semicolons, and other</span>
<span class="sd">such trickeries do not confuse it.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C.load(&#39;keebler=&quot;E=everybody; L=\\&quot;Loves\\&quot;; fudge=\\012;&quot;;&#39;)</span>
<span class="sd">   &gt;&gt;&gt; print C</span>
<span class="sd">   Set-Cookie: keebler=&quot;E=everybody; L=\&quot;Loves\&quot;; fudge=\012;&quot;</span>

<span class="sd">Each element of the Cookie also supports all of the RFC 2109</span>
<span class="sd">Cookie attributes.  Here&#39;s an example which sets the Path</span>
<span class="sd">attribute.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;oreo&quot;] = &quot;doublestuff&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;oreo&quot;][&quot;path&quot;] = &quot;/&quot;</span>
<span class="sd">   &gt;&gt;&gt; print C</span>
<span class="sd">   Set-Cookie: oreo=doublestuff; Path=/</span>

<span class="sd">Each dictionary element has a &#39;value&#39; attribute, which gives you</span>
<span class="sd">back the value associated with the key.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;twix&quot;] = &quot;none for you&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;twix&quot;].value</span>
<span class="sd">   &#39;none for you&#39;</span>


<span class="sd">A Bit More Advanced</span>
<span class="sd">-------------------</span>

<span class="sd">As mentioned before, there are three different flavors of Cookie</span>
<span class="sd">objects, each with different encoding/decoding semantics.  This</span>
<span class="sd">section briefly discusses the differences.</span>

<span class="sd">SimpleCookie</span>

<span class="sd">The SimpleCookie expects that all values should be standard strings.</span>
<span class="sd">Just to be sure, SimpleCookie invokes the str() builtin to convert</span>
<span class="sd">the value to a string, when the values are set dictionary-style.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SimpleCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;] = 7</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;] = &quot;seven&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;].value</span>
<span class="sd">   &#39;7&#39;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;].value</span>
<span class="sd">   &#39;seven&#39;</span>
<span class="sd">   &gt;&gt;&gt; C.output()</span>
<span class="sd">   &#39;Set-Cookie: number=7\r\nSet-Cookie: string=seven&#39;</span>


<span class="sd">SerialCookie</span>

<span class="sd">The SerialCookie expects that all values should be serialized using</span>
<span class="sd">cPickle (or pickle, if cPickle isn&#39;t available).  As a result of</span>
<span class="sd">serializing, SerialCookie can save almost any Python object to a</span>
<span class="sd">value, and recover the exact same object when the cookie has been</span>
<span class="sd">returned.  (SerialCookie can yield some strange-looking cookie</span>
<span class="sd">values, however.)</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SerialCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;] = 7</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;] = &quot;seven&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;].value</span>
<span class="sd">   7</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;].value</span>
<span class="sd">   &#39;seven&#39;</span>
<span class="sd">   &gt;&gt;&gt; C.output()</span>
<span class="sd">   &#39;Set-Cookie: number=&quot;I7\\012.&quot;\r\nSet-Cookie: string=&quot;S\&#39;seven\&#39;\\012p1\\012.&quot;&#39;  # noqa</span>

<span class="sd">Be warned, however, if SerialCookie cannot de-serialize a value (because</span>
<span class="sd">it isn&#39;t a valid pickle&#39;d object), IT WILL RAISE AN EXCEPTION.</span>


<span class="sd">SmartCookie</span>

<span class="sd">The SmartCookie combines aspects of each of the other two flavors.</span>
<span class="sd">When setting a value in a dictionary-fashion, the SmartCookie will</span>
<span class="sd">serialize (ala cPickle) the value *if and only if* it isn&#39;t a</span>
<span class="sd">Python string.  String objects are *not* serialized.  Similarly,</span>
<span class="sd">when the load() method parses out values, it attempts to de-serialize</span>
<span class="sd">the value.  If it fails, then it fallsback to treating the value</span>
<span class="sd">as a string.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.SmartCookie()</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;] = 7</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;] = &quot;seven&quot;</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;number&quot;].value</span>
<span class="sd">   7</span>
<span class="sd">   &gt;&gt;&gt; C[&quot;string&quot;].value</span>
<span class="sd">   &#39;seven&#39;</span>
<span class="sd">   &gt;&gt;&gt; C.output()</span>
<span class="sd">   &#39;Set-Cookie: number=&quot;I7\\012.&quot;\r\nSet-Cookie: string=seven&#39;</span>


<span class="sd">Backwards Compatibility</span>
<span class="sd">-----------------------</span>

<span class="sd">In order to keep compatibilty with earlier versions of Cookie.py,</span>
<span class="sd">it is still possible to use Cookie.Cookie() to create a Cookie.  In</span>
<span class="sd">fact, this simply returns a SmartCookie.</span>

<span class="sd">   &gt;&gt;&gt; C = Cookie.Cookie()</span>
<span class="sd">   &gt;&gt;&gt; print C.__class__.__name__</span>
<span class="sd">   SmartCookie</span>


<span class="sd">Finis.</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># Import our required modules</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">pickle</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CookieError&quot;</span><span class="p">,</span> <span class="s2">&quot;BaseCookie&quot;</span><span class="p">,</span> <span class="s2">&quot;SimpleCookie&quot;</span><span class="p">,</span> <span class="s2">&quot;SerialCookie&quot;</span><span class="p">,</span>
           <span class="s2">&quot;SmartCookie&quot;</span><span class="p">,</span> <span class="s2">&quot;Cookie&quot;</span><span class="p">]</span>

<span class="n">_nulljoin</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span>
<span class="n">_semispacejoin</span> <span class="o">=</span> <span class="s1">&#39;; &#39;</span><span class="o">.</span><span class="n">join</span>
<span class="n">_spacejoin</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span>

<span class="c1">#</span>
<span class="c1"># Define an exception visible to External modules</span>
<span class="c1">#</span>


<div class="viewcode-block" id="CookieError"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.CookieError">[docs]</a><span class="k">class</span> <span class="nc">CookieError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># These quoting routines conform to the RFC2109 specification, which in</span>
<span class="c1"># turn references the character definitions from RFC2068.  They provide</span>
<span class="c1"># a two-way quoting algorithm.  Any non-text character is translated</span>
<span class="c1"># into a 4 character sequence: a forward-slash followed by the</span>
<span class="c1"># three-digit octal equivalent of the character.  Any &#39;\&#39; or &#39;&quot;&#39; is</span>
<span class="c1"># quoted with a preceding &#39;\&#39; slash.</span>
<span class="c1">#</span>
<span class="c1"># These are taken from RFC2068 and RFC2109.</span>
<span class="c1">#       _LegalChars       is the list of chars which don&#39;t require &quot;&#39;s</span>
<span class="c1">#       _Translator       hash-table for fast quoting</span>
<span class="c1">#</span>
<span class="c1"># The legal chars have been expanded a bit to match modern browsers</span>

<span class="n">_LegalChars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="s2">&quot;!#$%&amp;&#39;*+-.^_`|~[]:/@</span><span class="si">{}</span><span class="s2">(),?&lt;&gt;&quot;</span>  <span class="c1"># noqa</span>
<span class="n">_Translator</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;</span><span class="se">\000</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">000&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\001</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">001&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\002</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">002&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\003</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">003&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\004</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">004&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\005</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">005&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\006</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">006&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\007</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">007&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\010</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">010&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\011</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">011&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\012</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">012&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\013</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">013&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\014</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">014&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\015</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">015&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\016</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">016&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\017</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">017&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\020</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">020&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\021</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">021&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\022</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">022&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\023</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">023&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\024</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">024&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\025</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">025&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\026</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">026&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\027</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">027&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\030</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">030&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\031</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">031&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\032</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">032&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">033&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\034</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">034&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\035</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">035&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\036</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">036&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\037</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">037&#39;</span><span class="p">,</span>

    <span class="c1"># Because of the way browsers really handle cookies (as opposed</span>
    <span class="c1"># to what the RFC says) we also encode , and ;</span>

    <span class="s1">&#39;,&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">054&#39;</span><span class="p">,</span> <span class="s1">&#39;;&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">073&#39;</span><span class="p">,</span>

    <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">,</span>

    <span class="s1">&#39;</span><span class="se">\177</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">177&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\200</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">200&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\201</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">201&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\202</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">202&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\203</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">203&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\204</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">204&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\205</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">205&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\206</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">206&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\207</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">207&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\210</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">210&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\211</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">211&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\212</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">212&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\213</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">213&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\214</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">214&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\215</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">215&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\216</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">216&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\217</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">217&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\220</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">220&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\221</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">221&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\222</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">222&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\223</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">223&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\224</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">224&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\225</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">225&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\226</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">226&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\227</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">227&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\230</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">230&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\231</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">231&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\232</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">232&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\233</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">233&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\234</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">234&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\235</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">235&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\236</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">236&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\237</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">237&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\240</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">240&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\241</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">241&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\242</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">242&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\243</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">243&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\244</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">244&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\245</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">245&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\246</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">246&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\247</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">247&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\250</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">250&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\251</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">251&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\252</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">252&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\253</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">253&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\254</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">254&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\255</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">255&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\256</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">256&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\257</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">257&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\260</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">260&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\261</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">261&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\262</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">262&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\263</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">263&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\264</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">264&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\265</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">265&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\266</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">266&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\267</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">267&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\270</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">270&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\271</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">271&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\272</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">272&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\273</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">273&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\274</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">274&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\275</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">275&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\276</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">276&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\277</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">277&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\300</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">300&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\301</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">301&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\302</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">302&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\303</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">303&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\304</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">304&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\305</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">305&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\306</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">306&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\307</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">307&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\310</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">310&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\311</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">311&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\312</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">312&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\313</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">313&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\314</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">314&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\315</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">315&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\316</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">316&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\317</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">317&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\320</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">320&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\321</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">321&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\322</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">322&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\323</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">323&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\324</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">324&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\325</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">325&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\326</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">326&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\327</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">327&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\330</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">330&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\331</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">331&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\332</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">332&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\333</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">333&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\334</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">334&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\335</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">335&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\336</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">336&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\337</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">337&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\340</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">340&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\341</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">341&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\342</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">342&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\343</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">343&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\344</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">344&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\345</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">345&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\346</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">346&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\347</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">347&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\350</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">350&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\351</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">351&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\352</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">352&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\353</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">353&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\354</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">354&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\355</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">355&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\356</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">356&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\357</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">357&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\360</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">360&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\361</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">361&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\362</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">362&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\363</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">363&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\364</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">364&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\365</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">365&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\366</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">366&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\367</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">367&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\370</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">370&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\371</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">371&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\372</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">372&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\373</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">373&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\374</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">374&#39;</span><span class="p">,</span>
    <span class="s1">&#39;</span><span class="se">\375</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">375&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\376</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">376&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\377</span><span class="s1">&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">377&#39;</span>
<span class="p">}</span>

<span class="n">_idmap</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_quote</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">LegalChars</span><span class="o">=</span><span class="n">_LegalChars</span><span class="p">,</span>
           <span class="n">idmap</span><span class="o">=</span><span class="n">_idmap</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">translate</span><span class="p">):</span>
    <span class="c1">#</span>
    <span class="c1"># If the string does not need to be double-quoted,</span>
    <span class="c1"># then just return the string.  Otherwise, surround</span>
    <span class="c1"># the string in doublequotes and precede quote (with a \)</span>
    <span class="c1"># special characters.</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="o">==</span> <span class="n">translate</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">idmap</span><span class="p">,</span> <span class="n">LegalChars</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="n">_nulljoin</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">_Translator</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span>
<span class="c1"># end _quote</span>


<span class="n">_OctalPatt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">[0-3][0-7][0-7]&quot;</span><span class="p">)</span>
<span class="n">_QuotePatt</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[</span><span class="se">\\</span><span class="s2">].&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_unquote</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="c1"># If there aren&#39;t any doublequotes,</span>
    <span class="c1"># then there can&#39;t be any special characters.  See RFC 2109.</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&quot;&#39;</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span>

    <span class="c1"># We have to assume that we must decode this string.</span>
    <span class="c1"># Down to work.</span>

    <span class="c1"># Remove the &quot;s</span>
    <span class="nb">str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Check for special sequences.  Examples:</span>
    <span class="c1">#    \012 --&gt; \n</span>
    <span class="c1">#    \&quot;   --&gt; &quot;</span>
    <span class="c1">#</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">Omatch</span> <span class="o">=</span> <span class="n">_OctalPatt</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">Qmatch</span> <span class="o">=</span> <span class="n">_QuotePatt</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Omatch</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Qmatch</span><span class="p">:</span>              <span class="c1"># Neither matched</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
            <span class="k">break</span>
        <span class="c1"># else:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">Omatch</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">Omatch</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Qmatch</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">Qmatch</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Qmatch</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Omatch</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">):</span>     <span class="c1"># QuotePatt matched</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">k</span><span class="p">])</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>                                      <span class="c1"># OctalPatt matched</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">4</span><span class="p">],</span> <span class="mi">8</span><span class="p">)))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">4</span>
    <span class="k">return</span> <span class="n">_nulljoin</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="c1"># end _unquote</span>

<span class="c1"># The _getdate() routine is used to set the expiration time in</span>
<span class="c1"># the cookie&#39;s HTTP header. By default, _getdate() returns the</span>
<span class="c1"># current time in the appropriate &quot;expires&quot; format for a</span>
<span class="c1"># Set-Cookie header.  The one optional argument is an offset from</span>
<span class="c1"># now, in seconds.  For example, an offset of -3600 means &quot;one hour ago&quot;.</span>
<span class="c1"># The offset may be a floating point number.</span>
<span class="c1">#</span>


<span class="n">_weekdayname</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Mon&#39;</span><span class="p">,</span> <span class="s1">&#39;Tue&#39;</span><span class="p">,</span> <span class="s1">&#39;Wed&#39;</span><span class="p">,</span> <span class="s1">&#39;Thu&#39;</span><span class="p">,</span> <span class="s1">&#39;Fri&#39;</span><span class="p">,</span> <span class="s1">&#39;Sat&#39;</span><span class="p">,</span> <span class="s1">&#39;Sun&#39;</span><span class="p">]</span>


<span class="n">_monthname</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span>
              <span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">_getdate</span><span class="p">(</span><span class="n">future</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">weekdayname</span><span class="o">=</span><span class="n">_weekdayname</span><span class="p">,</span> <span class="n">monthname</span><span class="o">=</span><span class="n">_monthname</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">gmtime</span><span class="p">,</span> <span class="n">time</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">wd</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">gmtime</span><span class="p">(</span><span class="n">now</span> <span class="o">+</span> <span class="n">future</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">, </span><span class="si">%02d</span><span class="s2"> </span><span class="si">%3s</span><span class="s2"> </span><span class="si">%4d</span><span class="s2"> </span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2">:</span><span class="si">%02d</span><span class="s2"> GMT&quot;</span> <span class="o">%</span> \
           <span class="p">(</span><span class="n">weekdayname</span><span class="p">[</span><span class="n">wd</span><span class="p">],</span> <span class="n">day</span><span class="p">,</span> <span class="n">monthname</span><span class="p">[</span><span class="n">month</span><span class="p">],</span> <span class="n">year</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">mm</span><span class="p">,</span> <span class="n">ss</span><span class="p">)</span>


<span class="c1">#</span>
<span class="c1"># A class to hold ONE key,value pair.</span>
<span class="c1"># In a cookie, each such pair may have several attributes.</span>
<span class="c1">#       so this class is used to keep the attributes associated</span>
<span class="c1">#       with the appropriate key,value pair.</span>
<span class="c1"># This class also includes a coded_value attribute, which</span>
<span class="c1">#       is used to hold the network representation of the</span>
<span class="c1">#       value.  This is most useful when Python objects are</span>
<span class="c1">#       pickled for network transit.</span>
<span class="c1">#</span>

<span class="k">class</span> <span class="nc">Morsel</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="c1"># RFC 2109 lists these attributes as reserved:</span>
    <span class="c1">#   path       comment         domain</span>
    <span class="c1">#   max-age    secure      version</span>
    <span class="c1">#</span>
    <span class="c1"># For historical reasons, these attributes are also reserved:</span>
    <span class="c1">#   expires</span>
    <span class="c1">#</span>
    <span class="c1"># This is an extension from Microsoft:</span>
    <span class="c1">#   httponly</span>
    <span class="c1">#</span>
    <span class="c1"># This dictionary provides a mapping from the lowercase</span>
    <span class="c1"># variant on the left to the appropriate traditional</span>
    <span class="c1"># formatting on the right.</span>
    <span class="n">_reserved</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;expires&quot;</span><span class="p">:</span> <span class="s2">&quot;expires&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;Path&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;comment&quot;</span><span class="p">:</span> <span class="s2">&quot;Comment&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;Domain&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;max-age&quot;</span><span class="p">:</span> <span class="s2">&quot;Max-Age&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;secure&quot;</span><span class="p">:</span> <span class="s2">&quot;secure&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;httponly&quot;</span><span class="p">:</span> <span class="s2">&quot;httponly&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;Version&quot;</span><span class="p">,</span>
                 <span class="p">}</span>

    <span class="n">_flags</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;secure&#39;</span><span class="p">,</span> <span class="s1">&#39;httponly&#39;</span><span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Set defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coded_value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set default attributes</span>
        <span class="k">for</span> <span class="n">K</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="c1"># end __init__</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">K</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CookieError</span><span class="p">(</span><span class="s2">&quot;Invalid Attribute </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">K</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>
    <span class="c1"># end __setitem__</span>

    <span class="k">def</span> <span class="nf">isReservedKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">K</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span>
    <span class="c1"># end isReservedKey</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">coded_val</span><span class="p">,</span>
            <span class="n">LegalChars</span><span class="o">=</span><span class="n">_LegalChars</span><span class="p">,</span>
            <span class="n">idmap</span><span class="o">=</span><span class="n">_idmap</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">translate</span><span class="p">):</span>
        <span class="c1"># First we verify that the key isn&#39;t a reserved word</span>
        <span class="c1"># Second we make sure it only contains legal characters</span>
        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">CookieError</span><span class="p">(</span><span class="s2">&quot;Attempt to set a reserved key: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;&quot;</span> <span class="o">!=</span> <span class="n">translate</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">idmap</span><span class="p">,</span> <span class="n">LegalChars</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">CookieError</span><span class="p">(</span><span class="s2">&quot;Illegal key value: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>

        <span class="c1"># It&#39;s a good key, so save it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coded_value</span> <span class="o">=</span> <span class="n">coded_val</span>
    <span class="c1"># end set</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;Set-Cookie:&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OutputString</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="n">output</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">js_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Print javascript</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script type=&quot;text/javascript&quot;&gt;</span>
<span class="s2">        &lt;!-- begin hiding</span>
<span class="s2">        document.cookie = </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2">;</span>
<span class="s2">        // end hiding --&gt;</span>
<span class="s2">        &lt;/script&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OutputString</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\&quot;&#39;</span><span class="p">),)</span>
    <span class="c1"># end js_output()</span>

    <span class="k">def</span> <span class="nf">OutputString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Build up our result</span>
        <span class="c1">#</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">RA</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span>

        <span class="c1"># First, the key=value pair</span>
        <span class="n">RA</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coded_value</span><span class="p">))</span>

        <span class="c1"># Now add any defined attributes</span>
        <span class="k">if</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span>

        <span class="k">for</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">V</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">K</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">K</span> <span class="o">==</span> <span class="s2">&quot;expires&quot;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># noqa</span>
                <span class="n">RA</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="n">K</span><span class="p">],</span> <span class="n">_getdate</span><span class="p">(</span><span class="n">V</span><span class="p">)))</span>
            <span class="k">elif</span> <span class="n">K</span> <span class="o">==</span> <span class="s2">&quot;max-age&quot;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">V</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>  <span class="c1"># noqa</span>
                <span class="n">RA</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="n">K</span><span class="p">],</span> <span class="n">V</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">K</span> <span class="o">==</span> <span class="s2">&quot;secure&quot;</span><span class="p">:</span>
                <span class="n">RA</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="n">K</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">K</span> <span class="o">==</span> <span class="s2">&quot;httponly&quot;</span><span class="p">:</span>
                <span class="n">RA</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="n">K</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">RA</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_reserved</span><span class="p">[</span><span class="n">K</span><span class="p">],</span> <span class="n">V</span><span class="p">))</span>

        <span class="c1"># Return the result</span>
        <span class="k">return</span> <span class="n">_semispacejoin</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="c1"># end OutputString</span>
<span class="c1"># end Morsel class</span>


<span class="c1">#</span>
<span class="c1"># Pattern for finding cookie</span>
<span class="c1">#</span>
<span class="c1"># This used to be strict parsing based on the RFC2109 and RFC2068,</span>
<span class="c1"># however modern browsers no longer seem to enforce any of the character</span>
<span class="c1"># set rules. As such, a semi-limited set of characters are permitted in the</span>
<span class="c1"># key string and all characters are permitted in the value string (except ;)</span>

<span class="n">_LegalCharsPatt</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;[\w\d!#%&amp;&#39;~_`&gt;&lt;@,:/\$\*\+\-\.\^\|\)\(\?\}\{\[\]</span><span class="se">\&quot;</span><span class="s2">]&quot;</span>
<span class="n">_CookiePattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;(?x)&quot;</span>                       <span class="c1"># This is a Verbose pattern</span>
    <span class="sa">r</span><span class="s2">&quot;(?P&lt;key&gt;&quot;</span>                   <span class="c1"># Start of group &#39;key&#39;</span>
    <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="n">_LegalCharsPatt</span> <span class="o">+</span> <span class="s2">&quot;+?&quot;</span>   <span class="c1"># Any word of at least one letter, nongreedy</span>
    <span class="sa">r</span><span class="s2">&quot;)&quot;</span>                          <span class="c1"># End of group &#39;key&#39;</span>
    <span class="sa">r</span><span class="s2">&quot;(&quot;</span>                          <span class="c1"># Optional group: there may not be a value.</span>
    <span class="sa">r</span><span class="s2">&quot;\s*=\s*&quot;</span>                    <span class="c1"># Equal Sign</span>
    <span class="sa">r</span><span class="s2">&quot;(?P&lt;val&gt;&quot;</span>                   <span class="c1"># Start of group &#39;val&#39;</span>
    <span class="sa">r</span><span class="s2">&quot;.*?&quot;</span>                        <span class="c1"># Any character</span>
    <span class="sa">r</span><span class="s2">&quot;)&quot;</span>                          <span class="c1"># End of group &#39;val&#39;</span>
    <span class="sa">r</span><span class="s2">&quot;)?&quot;</span>                         <span class="c1"># End of optional value group</span>
    <span class="sa">r</span><span class="s2">&quot;\s*&quot;</span>                        <span class="c1"># Any number of spaces.</span>
    <span class="sa">r</span><span class="s2">&quot;(;|$)&quot;</span>                      <span class="c1"># Ending at semicolon or EOS.</span>
<span class="p">)</span>


<span class="c1"># At long last, here is the cookie class.</span>
<span class="c1"># Using this class is almost just like using a dictionary.</span>
<span class="c1"># See this module&#39;s docstring for example usage.</span>
<span class="c1">#</span>
<div class="viewcode-block" id="BaseCookie"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie">[docs]</a><span class="k">class</span> <span class="nc">BaseCookie</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="c1"># A container class for a set of Morsels</span>
    <span class="c1">#</span>

<div class="viewcode-block" id="BaseCookie.value_decode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie.value_decode">[docs]</a>    <span class="k">def</span> <span class="nf">value_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;real_value, coded_value = value_decode(STRING)</span>
<span class="sd">        Called prior to setting a cookie&#39;s value from the network</span>
<span class="sd">        representation.  The VALUE is the value read from HTTP</span>
<span class="sd">        header.</span>
<span class="sd">        Override this function to modify the behavior of cookies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">val</span></div>
    <span class="c1"># end value_encode</span>

<div class="viewcode-block" id="BaseCookie.value_encode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie.value_encode">[docs]</a>    <span class="k">def</span> <span class="nf">value_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;real_value, coded_value = value_encode(VALUE)</span>
<span class="sd">        Called prior to setting a cookie&#39;s value from the dictionary</span>
<span class="sd">        representation.  The VALUE is the value being assigned.</span>
<span class="sd">        Override this function to modify the behavior of cookies.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strval</span><span class="p">,</span> <span class="n">strval</span></div>
    <span class="c1"># end value_encode</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">input</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="c1"># end __init__</span>

    <span class="k">def</span> <span class="nf">__set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">real_value</span><span class="p">,</span> <span class="n">coded_value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Private method for setting a cookie&#39;s value&quot;&quot;&quot;</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">Morsel</span><span class="p">())</span>
        <span class="n">M</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">real_value</span><span class="p">,</span> <span class="n">coded_value</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
    <span class="c1"># end __set</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary style assignment.&quot;&quot;&quot;</span>
        <span class="n">rval</span><span class="p">,</span> <span class="n">cval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_encode</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">rval</span><span class="p">,</span> <span class="n">cval</span><span class="p">)</span>
    <span class="c1"># end __setitem__</span>

<div class="viewcode-block" id="BaseCookie.output"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie.output">[docs]</a>    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s2">&quot;Set-Cookie:&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\015\012</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a string suitable for HTTP.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">attrs</span><span class="p">,</span> <span class="n">header</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
    <span class="c1"># end output</span>

    <span class="fm">__str__</span> <span class="o">=</span> <span class="n">output</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">_spacejoin</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>

<div class="viewcode-block" id="BaseCookie.js_output"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie.js_output">[docs]</a>    <span class="k">def</span> <span class="nf">js_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a string suitable for JavaScript.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="o">.</span><span class="n">js_output</span><span class="p">(</span><span class="n">attrs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_nulljoin</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>
    <span class="c1"># end js_output</span>

<div class="viewcode-block" id="BaseCookie.load"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.BaseCookie.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rawdata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load cookies from a string (presumably HTTP_COOKIE) or</span>
<span class="sd">        from a dictionary.  Loading cookies from a dictionary &#39;d&#39;</span>
<span class="sd">        is equivalent to calling:</span>
<span class="sd">            map(Cookie.__setitem__, d.keys(), d.values())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># noqa</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__ParseString</span><span class="p">(</span><span class="n">rawdata</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.update() wouldn&#39;t call our custom __setitem__</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">rawdata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span></div>
    <span class="c1"># end load()</span>

    <span class="k">def</span> <span class="nf">__ParseString</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">patt</span><span class="o">=</span><span class="n">_CookiePattern</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>            <span class="c1"># Our starting point</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>     <span class="c1"># Length of string</span>
        <span class="n">M</span> <span class="o">=</span> <span class="kc">None</span>         <span class="c1"># current morsel</span>

        <span class="k">while</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
            <span class="c1"># Start looking for a cookie</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">patt</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="k">break</span>          <span class="c1"># No more cookies</span>

            <span class="n">K</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;key&quot;</span><span class="p">),</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;val&quot;</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Parse the key, value in case it&#39;s metainfo</span>
            <span class="c1"># Some sites use &#39;$&#39; at the start of cookie names</span>
            <span class="k">if</span> <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;$&quot;</span> <span class="ow">and</span> <span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">Morsel</span><span class="o">.</span><span class="n">_reserved</span><span class="p">:</span>
                <span class="c1"># We ignore attributes which pertain to the cookie</span>
                <span class="c1"># mechanism as a whole.  See RFC 2109.</span>
                <span class="c1"># (Does anyone care?)</span>
                <span class="k">if</span> <span class="n">M</span><span class="p">:</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">K</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">V</span>
            <span class="k">elif</span> <span class="n">K</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Morsel</span><span class="o">.</span><span class="n">_reserved</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">M</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">V</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">K</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">Morsel</span><span class="o">.</span><span class="n">_flags</span><span class="p">:</span>
                            <span class="n">M</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">M</span><span class="p">[</span><span class="n">K</span><span class="p">]</span> <span class="o">=</span> <span class="n">_unquote</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">V</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">rval</span><span class="p">,</span> <span class="n">cval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_decode</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__set</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">rval</span><span class="p">,</span> <span class="n">cval</span><span class="p">)</span>
                <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">K</span><span class="p">]</span></div>
    <span class="c1"># end __ParseString</span>
<span class="c1"># end BaseCookie class</span>


<div class="viewcode-block" id="SimpleCookie"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SimpleCookie">[docs]</a><span class="k">class</span> <span class="nc">SimpleCookie</span><span class="p">(</span><span class="n">BaseCookie</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SimpleCookie</span>
<span class="sd">    SimpleCookie supports strings as cookie values.  When setting</span>
<span class="sd">    the value using the dictionary assignment notation, SimpleCookie</span>
<span class="sd">    calls the builtin str() to convert the value to a string.  Values</span>
<span class="sd">    received from HTTP are kept as strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="SimpleCookie.value_decode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SimpleCookie.value_decode">[docs]</a>    <span class="k">def</span> <span class="nf">value_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_unquote</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">val</span></div>

<div class="viewcode-block" id="SimpleCookie.value_encode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SimpleCookie.value_encode">[docs]</a>    <span class="k">def</span> <span class="nf">value_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">strval</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">strval</span><span class="p">,</span> <span class="n">_quote</span><span class="p">(</span><span class="n">strval</span><span class="p">)</span></div></div>
<span class="c1"># end SimpleCookie</span>


<div class="viewcode-block" id="SerialCookie"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SerialCookie">[docs]</a><span class="k">class</span> <span class="nc">SerialCookie</span><span class="p">(</span><span class="n">BaseCookie</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SerialCookie</span>
<span class="sd">    SerialCookie supports arbitrary objects as cookie values. All</span>
<span class="sd">    values are serialized (using cPickle) before being sent to the</span>
<span class="sd">    client.  All incoming values are assumed to be valid Pickle</span>
<span class="sd">    representations.  IF AN INCOMING VALUE IS NOT IN A VALID PICKLE</span>
<span class="sd">    FORMAT, THEN AN EXCEPTION WILL BE RAISED.</span>

<span class="sd">    Note: Large cookie values add overhead because they must be</span>
<span class="sd">    retransmitted on every HTTP transaction.</span>

<span class="sd">    Note: HTTP has a 2k limit on the size of a cookie.  This class</span>
<span class="sd">    does not check for this limit, so be careful!!!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;SerialCookie class is insecure; do not use it&quot;</span><span class="p">,</span>
                      <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">BaseCookie</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
    <span class="c1"># end __init__</span>

<div class="viewcode-block" id="SerialCookie.value_decode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SerialCookie.value_decode">[docs]</a>    <span class="k">def</span> <span class="nf">value_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="c1"># This could raise an exception!</span>
        <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">_unquote</span><span class="p">(</span><span class="n">val</span><span class="p">)),</span> <span class="n">val</span></div>

<div class="viewcode-block" id="SerialCookie.value_encode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SerialCookie.value_encode">[docs]</a>    <span class="k">def</span> <span class="nf">value_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">_quote</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></div></div>
<span class="c1"># end SerialCookie</span>


<div class="viewcode-block" id="SmartCookie"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SmartCookie">[docs]</a><span class="k">class</span> <span class="nc">SmartCookie</span><span class="p">(</span><span class="n">BaseCookie</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SmartCookie</span>
<span class="sd">    SmartCookie supports arbitrary objects as cookie values.  If the</span>
<span class="sd">    object is a string, then it is quoted.  If the object is not a</span>
<span class="sd">    string, however, then SmartCookie will use cPickle to serialize</span>
<span class="sd">    the object into a string representation.</span>

<span class="sd">    Note: Large cookie values add overhead because they must be</span>
<span class="sd">    retransmitted on every HTTP transaction.</span>

<span class="sd">    Note: HTTP has a 2k limit on the size of a cookie.  This class</span>
<span class="sd">    does not check for this limit, so be careful!!!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Cookie/SmartCookie class is insecure; do not use it&quot;</span><span class="p">,</span>
                      <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">BaseCookie</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">)</span>
    <span class="c1"># end __init__</span>

<div class="viewcode-block" id="SmartCookie.value_decode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SmartCookie.value_decode">[docs]</a>    <span class="k">def</span> <span class="nf">value_decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">strval</span> <span class="o">=</span> <span class="n">_unquote</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">loads</span><span class="p">(</span><span class="n">strval</span><span class="p">),</span> <span class="n">val</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">strval</span><span class="p">,</span> <span class="n">val</span></div>

<div class="viewcode-block" id="SmartCookie.value_encode"><a class="viewcode-back" href="../../../source/automation.utilities.html#automation.utilities.Cookie.SmartCookie.value_encode">[docs]</a>    <span class="k">def</span> <span class="nf">value_encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">):</span>  <span class="c1"># noqa</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">_quote</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">val</span><span class="p">,</span> <span class="n">_quote</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="n">val</span><span class="p">))</span></div></div>
<span class="c1"># end SmartCookie</span>


<span class="c1">###########################################################</span>
<span class="c1"># Backwards Compatibility:  Don&#39;t break any existing code!</span>

<span class="c1"># We provide Cookie() as an alias for SmartCookie()</span>
<span class="n">Cookie</span> <span class="o">=</span> <span class="n">SmartCookie</span>

<span class="c1">#</span>
<span class="c1">###########################################################</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>

<span class="c1"># Local Variables:</span>
<span class="c1"># tab-width: 4</span>
<span class="c1"># end:</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">OpenWPM</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../CommandSequence.html">The Lifetime of a CommandSequence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MarkAsIncomplete.html">Shutdown and Saving</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Mozilla.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>